# yaml-language-server: $schema=https://json.schemastore.org/any.json
# Test scenarios for azure-ai-agents-java skill evaluation
# Each scenario tests a specific usage pattern against acceptance criteria

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  # Client Setup
  - name: client_creation_default_credential
    prompt: |
      Create Java code to set up the Azure AI Agents clients using
      DefaultAzureCredential. Create all three sub-clients: AgentsClient,
      ConversationsClient, and ResponsesClient.
    expected_patterns:
      - "AgentsClientBuilder"
      - "DefaultAzureCredentialBuilder"
      - "buildAgentsClient"
      - "buildConversationsClient"
      - "buildResponsesClient"
      - 'System\.getenv\('
    forbidden_patterns:
      - 'endpoint\("https://'  # Hardcoded endpoint
      - 'AzureKeyCredential\("'  # Hardcoded key
    tags:
      - basic
      - authentication
      - client
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ClientSetup {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              
              AgentsClientBuilder builder = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint);
              
              AgentsClient agentsClient = builder.buildAgentsClient();
              ConversationsClient conversationsClient = builder.buildConversationsClient();
              ResponsesClient responsesClient = builder.buildResponsesClient();
              
              System.out.println("Clients initialized successfully");
          }
      }

  # Agent Creation
  - name: create_agent_with_prompt_definition
    prompt: |
      Create a Java example that creates a versioned agent using
      PromptAgentDefinition. Include proper imports and print the agent details.
    expected_patterns:
      - "PromptAgentDefinition"
      - "createAgentVersion"
      - "AgentVersionDetails"
      - "agent.getId()"
      - "agent.getName()"
    forbidden_patterns:
      - "createAgent("  # Wrong method
      - "new Agent("
    tags:
      - agents
      - basic
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.ai.agents.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class CreateAgent {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              String model = System.getenv("MODEL_DEPLOYMENT_NAME");
              
              AgentsClient agentsClient = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildAgentsClient();
              
              PromptAgentDefinition definition = new PromptAgentDefinition(model);
              
              AgentVersionDetails agent = agentsClient.createAgentVersion(
                  "my-assistant",
                  definition
              );
              
              System.out.println("Agent ID: " + agent.getId());
              System.out.println("Agent Name: " + agent.getName());
              System.out.println("Agent Version: " + agent.getVersion());
          }
      }

  # Conversation Management
  - name: create_conversation_add_messages
    prompt: |
      Create a Java example that creates a conversation and adds system
      and user messages using the ConversationsClient.
    expected_patterns:
      - "getConversationService"
      - "create()"
      - "ItemCreateParams"
      - "EasyInputMessage"
      - "Role.SYSTEM"
      - "Role.USER"
      - "addItem"
    forbidden_patterns:
      - "Role.HUMAN"
      - "Role.ASSISTANT"  # As input
    tags:
      - conversations
      - messages
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import com.openai.models.conversations.Conversation;
      import com.openai.models.conversations.items.ItemCreateParams;
      import com.openai.models.responses.EasyInputMessage;

      public class ConversationExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              
              ConversationsClient conversationsClient = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildConversationsClient();
              
              // Create conversation
              Conversation conversation = conversationsClient.getConversationService().create();
              System.out.println("Conversation ID: " + conversation.id());
              
              // Add messages
              conversationsClient.getConversationService().items().create(
                  ItemCreateParams.builder()
                      .conversationId(conversation.id())
                      .addItem(EasyInputMessage.builder()
                          .role(EasyInputMessage.Role.SYSTEM)
                          .content("You are a helpful assistant.")
                          .build())
                      .addItem(EasyInputMessage.builder()
                          .role(EasyInputMessage.Role.USER)
                          .content("Hello, how can you help me?")
                          .build())
                      .build()
              );
              
              System.out.println("Messages added to conversation");
          }
      }

  # Response Generation
  - name: create_response_with_model
    prompt: |
      Create a Java example that generates a response using the ResponsesClient
      with a model deployment. Include ResponseCreateParams and print the output.
    expected_patterns:
      - "ResponsesClient"
      - "ResponseCreateParams"
      - "getResponseService"
      - "create("
      - "input("
      - "model("
      - "response.output()"
    forbidden_patterns:
      - 'model\("gpt'  # Hardcoded model
    tags:
      - responses
      - basic
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import com.openai.models.responses.Response;
      import com.openai.models.responses.ResponseCreateParams;

      public class ResponseExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              String model = System.getenv("MODEL_DEPLOYMENT_NAME");
              
              ResponsesClient responsesClient = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildResponsesClient();
              
              ResponseCreateParams request = new ResponseCreateParams.Builder()
                  .input("What is Azure AI Foundry?")
                  .model(model)
                  .build();
              
              Response response = responsesClient.getResponseService().create(request);
              
              System.out.println("Response ID: " + response.id());
              System.out.println("Model: " + response.model());
              System.out.println("Output: " + response.output());
          }
      }

  # Complete Workflow
  - name: complete_agent_conversation_workflow
    prompt: |
      Create a complete Java workflow that creates an agent, creates a
      conversation, adds messages, and generates a response. Include cleanup.
    expected_patterns:
      - "AgentsClientBuilder"
      - "PromptAgentDefinition"
      - "createAgentVersion"
      - "getConversationService().create()"
      - "ItemCreateParams"
      - "ResponseCreateParams"
      - "deleteAgent"
    forbidden_patterns:
      - "openai.OpenAI"
    tags:
      - workflow
      - complete
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.ai.agents.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import com.openai.models.conversations.Conversation;
      import com.openai.models.conversations.items.ItemCreateParams;
      import com.openai.models.responses.*;

      public class CompleteWorkflow {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              String model = System.getenv("MODEL_DEPLOYMENT_NAME");
              
              AgentsClientBuilder builder = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint);
              
              AgentsClient agentsClient = builder.buildAgentsClient();
              ConversationsClient conversationsClient = builder.buildConversationsClient();
              ResponsesClient responsesClient = builder.buildResponsesClient();
              
              // 1. Create agent
              PromptAgentDefinition definition = new PromptAgentDefinition(model);
              AgentVersionDetails agent = agentsClient.createAgentVersion(
                  "workflow-agent",
                  definition
              );
              System.out.println("Created agent: " + agent.getName());
              
              // 2. Create conversation
              Conversation conversation = conversationsClient.getConversationService().create();
              System.out.println("Created conversation: " + conversation.id());
              
              // 3. Add messages
              conversationsClient.getConversationService().items().create(
                  ItemCreateParams.builder()
                      .conversationId(conversation.id())
                      .addItem(EasyInputMessage.builder()
                          .role(EasyInputMessage.Role.USER)
                          .content("What is the capital of France?")
                          .build())
                      .build()
              );
              
              // 4. Generate response
              ResponseCreateParams request = new ResponseCreateParams.Builder()
                  .input("What is the capital of France?")
                  .model(model)
                  .build();
              
              Response response = responsesClient.getResponseService().create(request);
              System.out.println("Response: " + response.output());
              
              // 5. Cleanup
              agentsClient.deleteAgent("workflow-agent");
              System.out.println("Deleted agent");
          }
      }

  # List and Get Agents
  - name: list_and_get_agents
    prompt: |
      Create a Java example that lists all agents and retrieves a specific
      agent by name. Show the agent details including versions.
    expected_patterns:
      - "listAgents"
      - "getAgent"
      - "AgentDetails"
      - "getVersions"
      - "getLatest"
    tags:
      - agents
      - list
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.ai.agents.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ListAgentsExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              
              AgentsClient agentsClient = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildAgentsClient();
              
              // List all agents
              System.out.println("=== All Agents ===");
              for (AgentDetails agent : agentsClient.listAgents()) {
                  System.out.println("Name: " + agent.getName());
                  System.out.println("ID: " + agent.getId());
                  if (agent.getVersions() != null && agent.getVersions().getLatest() != null) {
                      System.out.println("Latest Version: " + agent.getVersions().getLatest().getId());
                  }
                  System.out.println("---");
              }
              
              // Get specific agent
              String agentName = "my-agent";
              AgentDetails specificAgent = agentsClient.getAgent(agentName);
              System.out.println("\n=== Specific Agent ===");
              System.out.println("Name: " + specificAgent.getName());
              System.out.println("Latest Version: " + specificAgent.getVersions().getLatest());
          }
      }

  # Error Handling
  - name: error_handling
    prompt: |
      Create a Java example showing proper error handling when creating
      an agent. Handle HttpResponseException and print appropriate error messages.
    expected_patterns:
      - "HttpResponseException"
      - "try"
      - "catch"
      - "getResponse().getStatusCode()"
      - "getMessage()"
    forbidden_patterns:
      - "catch (Exception e) {}"  # Empty catch
      - "catch (Exception e) { }"
    tags:
      - error-handling
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.ai.agents.models.*;
      import com.azure.core.exception.HttpResponseException;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ErrorHandlingExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              String model = System.getenv("MODEL_DEPLOYMENT_NAME");
              
              AgentsClient agentsClient = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildAgentsClient();
              
              try {
                  PromptAgentDefinition definition = new PromptAgentDefinition(model);
                  AgentVersionDetails agent = agentsClient.createAgentVersion(
                      "my-agent",
                      definition
                  );
                  System.out.println("Agent created: " + agent.getId());
                  
              } catch (HttpResponseException e) {
                  int statusCode = e.getResponse().getStatusCode();
                  System.err.println("HTTP Status: " + statusCode);
                  System.err.println("Error: " + e.getMessage());
                  
                  switch (statusCode) {
                      case 400:
                          System.err.println("Bad request - check parameters");
                          break;
                      case 401:
                          System.err.println("Unauthorized - check credentials");
                          break;
                      case 404:
                          System.err.println("Resource not found");
                          break;
                      case 429:
                          System.err.println("Rate limited - retry with backoff");
                          break;
                      default:
                          System.err.println("Unexpected error");
                  }
              }
          }
      }

  # Async Client
  - name: async_client_usage
    prompt: |
      Create a Java example using the async client (AgentsAsyncClient)
      to create an agent. Use Mono/Flux reactive patterns.
    expected_patterns:
      - "AgentsAsyncClient"
      - "buildAsyncClient"
      - "subscribe"
      - "Mono"
    tags:
      - async
      - advanced
    mock_response: |
      import com.azure.ai.agents.*;
      import com.azure.ai.agents.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import reactor.core.publisher.Mono;

      public class AsyncAgentExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("PROJECT_ENDPOINT");
              String model = System.getenv("MODEL_DEPLOYMENT_NAME");
              
              AgentsAsyncClient agentsAsyncClient = new AgentsClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildAsyncClient();
              
              PromptAgentDefinition definition = new PromptAgentDefinition(model);
              
              Mono<AgentVersionDetails> agentMono = agentsAsyncClient.createAgentVersion(
                  "async-agent",
                  definition
              );
              
              agentMono.subscribe(
                  agent -> {
                      System.out.println("Agent created: " + agent.getName());
                      System.out.println("Agent ID: " + agent.getId());
                  },
                  error -> System.err.println("Error: " + error.getMessage()),
                  () -> System.out.println("Operation completed")
              );
              
              // Block for demo purposes
              agentMono.block();
          }
      }
