# yaml-language-server: $schema=https://json.schemastore.org/any.json
# Test scenarios for azure-ai-inference-java skill evaluation
# Each scenario tests a specific usage pattern against acceptance criteria

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  # Basic Chat Completion with DefaultAzureCredential
  - name: basic_chat_completion_default_credential
    prompt: |
      Create a Java chat completions example using DefaultAzureCredential
      with ChatRequestSystemMessage and ChatRequestUserMessage. Include
      printing the response content.
    expected_patterns:
      - "DefaultAzureCredentialBuilder"
      - "ChatCompletionsClient"
      - "ChatRequestSystemMessage"
      - "ChatRequestUserMessage"
      - "complete"
      - "getChoices"
    forbidden_patterns:
      - 'openai\.OpenAI'
      - 'chat\(\)\.completions\(\)'
    tags:
      - basic
      - authentication
      - chat
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class BasicChatCompletion {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant."));
              messages.add(new ChatRequestUserMessage("What is Azure AI?"));
              
              ChatCompletions response = client.complete(new ChatCompletionsOptions(messages));
              
              for (ChatChoice choice : response.getChoices()) {
                  System.out.println(choice.getMessage().getContent());
              }
          }
      }

  # API Key Authentication
  - name: api_key_chat_completion
    prompt: |
      Create a chat completions example using AzureKeyCredential with
      environment variables for the endpoint and credential.
    expected_patterns:
      - "AzureKeyCredential"
      - 'System\.getenv\('
      - "ChatCompletionsClient"
    forbidden_patterns:
      - 'AzureKeyCredential\("'  # Hardcoded key
      - 'endpoint\("https://'    # Hardcoded endpoint
    tags:
      - authentication
      - api-key
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class ApiKeyChatCompletion {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant."));
              messages.add(new ChatRequestUserMessage("Give me one fact about Azure."));
              
              ChatCompletions response = client.complete(new ChatCompletionsOptions(messages));
              
              System.out.println(response.getChoice().getMessage().getContent());
          }
      }

  # Streaming Chat Completions
  - name: streaming_chat_completions
    prompt: |
      Create a streaming chat completions example using completeStream
      and print the delta content as it arrives. Use forEach.
    expected_patterns:
      - "completeStream"
      - "forEach"
      - "getDelta"
      - "getContent"
      - "StreamingChatResponseMessageUpdate"
    forbidden_patterns:
      - "stream=True"
      - "stream: true"
    tags:
      - streaming
      - chat
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      import com.azure.core.util.CoreUtils;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class StreamingChatCompletion {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant."));
              messages.add(new ChatRequestUserMessage("Write a short poem about Azure."));
              
              client.completeStream(new ChatCompletionsOptions(messages))
                  .forEach(update -> {
                      if (!CoreUtils.isNullOrEmpty(update.getChoices())) {
                          StreamingChatResponseMessageUpdate delta = update.getChoice().getDelta();
                          if (delta.getContent() != null) {
                              System.out.print(delta.getContent());
                          }
                      }
                  });
          }
      }

  # Embeddings
  - name: embeddings_basic
    prompt: |
      Create an embeddings example using EmbeddingsClient and embed
      a list of text inputs, then print the embedding dimensions.
    expected_patterns:
      - "EmbeddingsClient"
      - "EmbeddingsClientBuilder"
      - "embed"
      - "getData"
      - "getEmbeddingList"
    forbidden_patterns:
      - "embeddings("  # Wrong method
      - "createEmbedding"
    tags:
      - embeddings
      - basic
    mock_response: |
      import com.azure.ai.inference.EmbeddingsClient;
      import com.azure.ai.inference.EmbeddingsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      
      import java.util.List;
      
      public class EmbeddingsExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              EmbeddingsClient client = new EmbeddingsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              List<String> input = List.of("first phrase", "second phrase");
              EmbeddingsResult result = client.embed(input);
              
              for (EmbeddingItem item : result.getData()) {
                  System.out.println("Index: " + item.getIndex());
                  System.out.println("Dimensions: " + item.getEmbeddingList().size());
              }
          }
      }

  # Chat with Message History
  - name: chat_with_message_history
    prompt: |
      Create a chat completions example with a multi-turn conversation
      history including system, user, and assistant messages.
    expected_patterns:
      - "ChatRequestSystemMessage"
      - "ChatRequestUserMessage"
      - "ChatRequestAssistantMessage"
      - "messages.add"
    tags:
      - chat
      - conversation
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class ChatWithHistory {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant that speaks like a pirate."));
              messages.add(new ChatRequestUserMessage("Can you help me?"));
              messages.add(new ChatRequestAssistantMessage("Of course, me hearty! What can I do for ye?"));
              messages.add(new ChatRequestUserMessage("What's the best way to train a parrot?"));
              
              ChatCompletions response = client.complete(new ChatCompletionsOptions(messages));
              
              System.out.println("Model: " + response.getModel());
              for (ChatChoice choice : response.getChoices()) {
                  System.out.println("Role: " + choice.getMessage().getRole());
                  System.out.println("Content: " + choice.getMessage().getContent());
              }
          }
      }

  # Vision - Image from URL
  - name: vision_image_url
    prompt: |
      Create a chat completions example that analyzes an image from URL
      using ChatMessageImageContentItem and ChatMessageImageUrl.
    expected_patterns:
      - "ChatMessageContentItem"
      - "ChatMessageTextContentItem"
      - "ChatMessageImageContentItem"
      - "ChatMessageImageUrl"
      - "fromContentItems"
    forbidden_patterns:
      - 'new ChatMessageImageContentItem\("[^"]*"'  # URL without wrapper
    tags:
      - vision
      - image
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class VisionImageUrl {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              String imageUrl = "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg";
              
              List<ChatMessageContentItem> contentItems = new ArrayList<>();
              contentItems.add(new ChatMessageTextContentItem("Describe this image."));
              contentItems.add(new ChatMessageImageContentItem(new ChatMessageImageUrl(imageUrl)));
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant."));
              messages.add(ChatRequestUserMessage.fromContentItems(contentItems));
              
              ChatCompletions response = client.complete(new ChatCompletionsOptions(messages));
              
              System.out.println(response.getChoice().getMessage().getContent());
          }
      }

  # Vision - Image from Local File
  - name: vision_image_file
    prompt: |
      Create a chat completions example that analyzes a local image file.
      Use Path and specify the image format.
    expected_patterns:
      - "Path"
      - "Paths.get"
      - "ChatMessageImageContentItem"
      - "fromContentItems"
    tags:
      - vision
      - file
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      
      import java.nio.file.Path;
      import java.nio.file.Paths;
      import java.util.ArrayList;
      import java.util.List;
      
      public class VisionImageFile {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              Path imagePath = Paths.get("./images/sample.png");
              String imageFormat = "png";
              
              List<ChatMessageContentItem> contentItems = new ArrayList<>();
              contentItems.add(new ChatMessageTextContentItem("What is in this image?"));
              contentItems.add(new ChatMessageImageContentItem(imagePath, imageFormat));
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant."));
              messages.add(ChatRequestUserMessage.fromContentItems(contentItems));
              
              ChatCompletions response = client.complete(new ChatCompletionsOptions(messages));
              
              System.out.println(response.getChoice().getMessage().getContent());
          }
      }

  # Async Client
  - name: async_chat_completions
    prompt: |
      Create an async chat completions example using ChatCompletionsAsyncClient
      with Mono/Flux reactive patterns and subscribe.
    expected_patterns:
      - "ChatCompletionsAsyncClient"
      - "buildAsyncClient"
      - "subscribe"
      - "Mono"
    tags:
      - async
      - chat
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsAsyncClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      import reactor.core.publisher.Mono;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class AsyncChatCompletion {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsAsyncClient asyncClient = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildAsyncClient();
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestSystemMessage("You are a helpful assistant."));
              messages.add(new ChatRequestUserMessage("Tell me a fun fact about Azure."));
              
              Mono<ChatCompletions> responseMono = asyncClient.complete(
                  new ChatCompletionsOptions(messages));
              
              responseMono.subscribe(
                  response -> System.out.println(response.getChoice().getMessage().getContent()),
                  error -> System.err.println("Error: " + error.getMessage()),
                  () -> System.out.println("Completed")
              );
              
              // Block for demo purposes
              responseMono.block();
          }
      }

  # Model Information
  - name: model_info
    prompt: |
      Create an example that retrieves and prints model information
      including model name, provider, and type.
    expected_patterns:
      - "getModelInfo"
      - "getModelName"
      - "getModelProviderName"
      - "getModelType"
    tags:
      - model
      - info
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.ModelInfo;
      import com.azure.core.credential.AzureKeyCredential;
      
      public class ModelInfoExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              ModelInfo modelInfo = client.getModelInfo();
              
              System.out.println("Model: " + modelInfo.getModelName());
              System.out.println("Provider: " + modelInfo.getModelProviderName());
              System.out.println("Type: " + modelInfo.getModelType());
          }
      }

  # Error Handling
  - name: error_handling
    prompt: |
      Create an example with proper error handling for chat completions.
      Handle HttpResponseException and print appropriate error messages.
    expected_patterns:
      - "HttpResponseException"
      - "try"
      - "catch"
      - "getResponse().getStatusCode()"
      - "getMessage()"
    forbidden_patterns:
      - "catch (Exception e) {}"
      - "catch (Exception e) { }"
    tags:
      - error-handling
    mock_response: |
      import com.azure.ai.inference.ChatCompletionsClient;
      import com.azure.ai.inference.ChatCompletionsClientBuilder;
      import com.azure.ai.inference.models.*;
      import com.azure.core.credential.AzureKeyCredential;
      import com.azure.core.exception.HttpResponseException;
      
      import java.util.ArrayList;
      import java.util.List;
      
      public class ErrorHandlingExample {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_INFERENCE_ENDPOINT");
              String key = System.getenv("AZURE_INFERENCE_CREDENTIAL");
              
              ChatCompletionsClient client = new ChatCompletionsClientBuilder()
                  .endpoint(endpoint)
                  .credential(new AzureKeyCredential(key))
                  .buildClient();
              
              List<ChatRequestMessage> messages = new ArrayList<>();
              messages.add(new ChatRequestUserMessage("Hello"));
              
              try {
                  ChatCompletions response = client.complete(new ChatCompletionsOptions(messages));
                  System.out.println(response.getChoice().getMessage().getContent());
                  
              } catch (HttpResponseException e) {
                  int statusCode = e.getResponse().getStatusCode();
                  System.err.println("HTTP Status: " + statusCode);
                  System.err.println("Error: " + e.getMessage());
                  
                  switch (statusCode) {
                      case 400:
                          System.err.println("Bad request - check input");
                          break;
                      case 401:
                          System.err.println("Unauthorized - check credentials");
                          break;
                      case 429:
                          System.err.println("Rate limited - retry with backoff");
                          break;
                      default:
                          System.err.println("Unexpected error");
                  }
              }
          }
      }
